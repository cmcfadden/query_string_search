<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Query string search by umn-asr</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Query string search</h1>
        <p class="header">Quick query-string-based filtering of data</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/umn-asr/query_string_search/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/umn-asr/query_string_search/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/umn-asr/query_string_search">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/umn-asr">umn-asr</a></p>


      </header>
      <section>
        <h1>
<a id="query-string-search" class="anchor" href="#query-string-search" aria-hidden="true"><span class="octicon octicon-link"></span></a>Query String Search</h1>

<p><a href="https://travis-ci.org/umn-asr/query_string_search"><img src="https://api.travis-ci.org/umn-asr/query_string_search.svg?branch=master" alt="Build Status"></a> 
<a href="https://codeclimate.com/github/umn-asr/query_string_search"><img src="https://codeclimate.com/github/umn-asr/query_string_search/badges/gpa.svg" alt="Code Climate"></a>
<a href="http://badge.fury.io/rb/query_string_search"><img src="https://badge.fury.io/rb/query_string_search.svg" alt="Gem Version"></a></p>

<p>Provides an easy way to implement searching in your API endpoints.</p>

<h2>
<a id="searches-it-supports" class="anchor" href="#searches-it-supports" aria-hidden="true"><span class="octicon octicon-link"></span></a>Searches it supports</h2>

<p>Say you have a <code>movies</code> endpoint and people want to be able to search your huge collection of movie data. Each of your movies have these properties</p>

<ul>
<li>Rating: returns "PG", "R", etc. Can also return nil</li>
<li>Year: returns the year the film was released</li>
<li>Title: The movie's title</li>
<li>Star Rating: returns a number 1 to 5</li>
<li>Home Formats: returns an array of available home formats. <code>["DVD", "BD"]</code>, for example.</li>
</ul>

<p>The API Search gem will give you the following search functionality:</p>

<table>
<thead>
<tr>
<th>Query String Example</th>
<th>What Data is Returned</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>movies</code></td>
<td>All data in your data set</td>
</tr>
<tr>
<td><code>movies?q=rating=all</code></td>
<td>Movies with a non-nil rating</td>
</tr>
<tr>
<td><code>movies?q=rating=none</code></td>
<td>Movies with a nil rating</td>
</tr>
<tr>
<td><code>movies?q=year=1994</code></td>
<td>Movies with a year of 1994</td>
</tr>
<tr>
<td><code>movies?q=year=1994|1995</code></td>
<td>Movies with a year of 1994 or 1995</td>
</tr>
<tr>
<td><code>movies?q=title=Dunston%20Checks%20In</code></td>
<td>Movies with the title Dunston Checks In</td>
</tr>
<tr>
<td><code>movies?q=star_rating&gt;1</code></td>
<td>Movies with a star rating greater than one</td>
</tr>
<tr>
<td><code>movies?q=star_rating&lt;3</code></td>
<td>Movies with a star rating less than three</td>
</tr>
<tr>
<td><code>movies?q=star_rating&gt;=2</code></td>
<td>Movies with a star rating greater than or equal to 2</td>
</tr>
<tr>
<td><code>movies?q=star_rating&lt;=4</code></td>
<td>Movies with a star rating less than or equal to 4</td>
</tr>
<tr>
<td><code>movies?q=home_formats=DVD</code></td>
<td>Movies that are available on DVD.</td>
</tr>
<tr>
<td><code>movies?q=home_formats=DVD|BD</code></td>
<td>Movies that are available on DVD or Blu Ray</td>
</tr>
</tbody>
</table>

<h3>
<a id="combining-searches" class="anchor" href="#combining-searches" aria-hidden="true"><span class="octicon octicon-link"></span></a>Combining Searches</h3>

<p>Any of the above critera can be combined. 
Just separate criteria with commas. 
Records that match <strong>all</strong> the criteria will be returned. 
Some examples!</p>

<p><code>movie?q=year=1994,country=US,rated=none</code><br>
 All un-rated movies made in the US in 1994.</p>

<p><code>movie?q=home_formats=BD|DVD,rated=R|PG,star_rating&gt;3</code><br>
All movies available on BD or DVD, that are rated R or PG, and that have a star rating greater than 3</p>

<h2>
<a id="use-cases" class="anchor" href="#use-cases" aria-hidden="true"><span class="octicon octicon-link"></span></a>Use Cases</h2>

<p>This gem fits best when you're trying to provide very flexible searching on a relatively small and flat set of data. Because it filters a data set that you provide, the speed at which it works is wholly dependent on the size of your data set.</p>

<p>We currently use this gem on a small (~2000 rows) data set which is cached in memory. Response times using Rails/Passenger/Apache are always under 100ms, usually under 50ms. That's plenty fast! But if your initial data set is massive, or you can't cache it, your response times will be slower. Such is life. Gems like <a href="https://rubygems.org/gems/periscope">Periscope</a> or <a href="https://rubygems.org/gems/has_scope">has_scope</a> may be more your speed.</p>

<p>A downside of gems like those, though, is that you end up defining all of your filtering methods in advance. This is not the case with Query String Search. If the elements in your data set respond to a method, then the data can be filtered by the return value of that method. It is possible that this is not what you want. In which case, check out those other gems. Or, you could also wrap your object instances in a wrapper that only responds to the methods that you want to filter on.</p>

<p>Also, this gem is platform and persistence agnostic. Rails? Sinatra? Cuba? Redis? Postgres? Doesn't matter. You pass it objects, it filters them down based on the query string.</p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>First, create a collection of data. With ActiveRecord or other ORMs this is straightforward:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-s3">Movie</span>.all</pre></div>

<p>Or something similar. As long as it returns a collection of objects, you should be good.</p>

<p>The objects must respond to the methods you want to search on. Say you want to allow a search string like this:</p>

<p><code>movies?q=year=1994</code></p>

<p>Then every object in your data collection needs to respond to <code>year</code>.</p>

<p>Second, search! In Rails you can do something like this in a Controller method.</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">def</span> <span class="pl-en">index</span>
  query_string <span class="pl-k">=</span> params[<span class="pl-c1">:q</span>]
  <span class="pl-s3">QueryStringSearch</span>.<span class="pl-k">new</span>(<span class="pl-s3">Movie</span>.all, query_string).results
  <span class="pl-c">#....</span>
<span class="pl-k">end</span></pre></div>

<p>This returns a collection of the objects that matched the search criteria.</p>

<p>Or you can do it not in the controller. This will work:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-s3">QueryStringSearch</span>.<span class="pl-k">new</span>(<span class="pl-s3">Movie</span>.all, <span class="pl-s1"><span class="pl-pds">"</span>country=us<span class="pl-pds">"</span></span>).results</pre></div>

<p>You get the idea. Pass in a data set and a query-stringish string and you'll get results back.</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Add this line to your application's Gemfile:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">gem</span> <span class="pl-s1"><span class="pl-pds">'</span>query_string_search<span class="pl-pds">'</span></span></pre></div>

<p>And then execute:</p>

<pre><code>$ bundle
</code></pre>

<h2>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h2>

<ul>
<li>Fork, branch, commit &amp; pull.</li>
<li>Tests are required.</li>
<li>Don't go against our Rubocop style guidelines.</li>
</ul>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p>Â© Regents of the University of Minnesota. All rights reserved.</p>
      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
